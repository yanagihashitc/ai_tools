---
name: code-review
description: 指定された差分を徹底的にレビューする（デフォルトは未ステージ）
---

まずユーザーの指示から「レビュー対象の差分」を決めてください。

## デフォルト（指定がない場合）
未ステージ差分のみをレビュー対象にする：
@git diff

## ユーザーが対象を指定した場合（指定があるときは必ず優先）
ユーザーの要望に応じて、以下のいずれか（または組み合わせ）をレビュー対象にする：

- ステージ済みをレビュー: `@git diff --cached`
- 未ステージ+ステージ済み（作業ツリー全体）をレビュー: `@git diff` と `@git diff --cached`
- 未pushコミットをレビュー: `@git diff @{push}..HEAD`
  - `@{push}` が解決できない場合: `@git diff @{u}..HEAD`
- mainブランチとの差分をレビュー（例: 「mainとの差分を」）: `@git diff main..HEAD`
- それ以外のブランチ/範囲指定（例: 「developとの差分」「タグv1.2.3との差分」「A..Bで」など）があれば、その指定に従って `@git diff <指定された範囲>` を使う

※ どの差分を採用したかを、レビュー冒頭に1行で宣言してから指摘を開始してください（例: 「レビュー対象: 未ステージ差分（git diff）」）。

以下の観点でチェックし、問題があれば日本語で、該当箇所がわかるようにコメント形式で指摘してください：

## チェック項目

### 🐛 バグの可能性
- ロジックエラー、エッジケースの未処理、NullPointerの可能性など

### 🔒 セキュリティ懸念
- 脆弱性、入力値の検証不足、機密情報の露出など

### ⚡ パフォーマンス問題
- 非効率なアルゴリズム、N+1問題、不要な処理など

### 📖 可読性/保守性
- 命名の不適切さ、複雑すぎる処理、コメント不足など

### 💡 より良い書き方の提案
- よりシンプルな実装、モダンな書き方、ベストプラクティスなど

## 出力形式

各問題について以下の形式で出力してください：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📁 ファイル名:行番号
カテゴリ: [バグ|セキュリティ|パフォーマンス|可読性|改善提案]
重要度: [🔴 高|🟡 中|🟢 低]

【問題のコード】
該当コードを引用

【指摘内容】
何が問題なのかを説明

【改善案】
どう修正すべきかを説明

【修正用プロンプト】
この問題を修正するためにそのままコピペして使えるプロンプトを記載
例: 「@ファイル名 の XX行目にある〇〇の処理を△△に修正して」
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 最後にサマリーを出力

- 検出した問題の総数（カテゴリ別・重要度別）
- 優先的に対応すべき項目のリスト
